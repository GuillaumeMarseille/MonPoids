/*
  TP3
  Équipe #15
  Frédéric Sheedy (908 378 744)
  Guillaume Marseille-Pitre (536 857 347)
*/

/* Effacer les sequences */
drop sequence TP2_NO_MEMBRE_SEQ;
drop sequence TP2_NO_ALIMENT_SEQ;

-- Question 1. a)
drop table TP2_ADMINISTRATEUR cascade constraints;
drop table TP2_MEMBRE cascade constraints;
drop table TP2_RABAIS cascade constraints;
drop table TP2_RECU cascade constraints;
drop table TP2_ALIMENT cascade constraints;
drop table TP2_RECETTE cascade constraints;
drop table TP2_RECETTE_ALIMENT cascade constraints;
drop table TP2_ACTIVITE cascade constraints;
drop table TP2_SEMAINE cascade constraints;
drop table TP2_JOUR_ALIMENT cascade constraints;
drop table TP2_JOUR_RECETTE cascade constraints;
drop table TP2_JOUR_ACTIVITE cascade constraints;

create table TP2_ADMINISTRATEUR (
    NOM_USAGER_ADMINISTRATEUR varchar2(20) not null,
    MOT_DE_PASSE_ADM varchar2(12) not null, 
    PRENOM_ADM varchar2(20) not null,
    NOM_ADM varchar2(20) not null,
    COURRIEL_ADM varchar2(30) not null,
    constraint PK_TP2_ADMINISTRATEUR primary key(NOM_USAGER_ADMINISTRATEUR),
    constraint AK_TP2_ADMINISTRATEUR unique(COURRIEL_ADM)
    );

create table TP2_MEMBRE (
    NO_MEMBRE number(6) not null, 
    NOM_USAGER_MEM varchar2(20) not null, 
    MOT_DE_PASSE_MEM varchar2(12) not null, 
    PRENOM_MEM varchar2(20) not null, 
    NOM_MEM varchar2(20) not null, 
    ADRESSE_MEM varchar2(30) null,
    VILLE_MEM varchar2(20) null, 
    CODE_POSTAL_MEM char(7) null, 
    TELEPHONE_MEM char(13) null, 
    COURRIEL_MEM varchar2(30) not null,
    BOOL_COURRIEL_EST_APPROUVE_MEM number(1) null, 
    SEXE_MEM char(1) not null, 
    TAILLE_MEM number(3,2) null, 
    DATE_INSCRIPTION_MEM date null,
    DATE_NAISSANCE_MEM date default to_date('2000-06-01', 'YYYY-MM-DD') not null, 
    NO_CARTE_CREDIT_MEM number(16) null, 
    EXPIRATION_CARTE_CREDIT_MEM number(4) null,
    CCV_CARTE_CREDIT_MEM number(3) null, 
    POIDS_INITIAL_MEM number(5,2) not null, 
    POIDS_DESIRE_MEM number(5,2) not null, 
    UNITE_POIDS_MEM char(2) default 'lb' not null,
    BOOL_EST_EN_MAINTIENT number(1) default 0 not null, 
    CHEMIN_PHOTO_AVANT_MEM varchar2(300) null, 
    CHEMIN_PHOTO_APRES_MEM varchar2(300) null,
    NO_MEMBRE_RECOMMANDE number(6) null,
    constraint PK_TP2_ME_NO_MEMBRE primary key(NO_MEMBRE),
    constraint AK_TP2_ME_COURRIEL_MEM unique(COURRIEL_MEM)
    );
    
create sequence TP2_NO_MEMBRE_SEQ start with 10 increment by 5;
    
create table TP2_RABAIS (
    CODE_RABAIS char(3) not null, 
    NOM_RABAIS varchar2(20) not null, 
    DATE_DEBUT_RAB date not null, 
    DATE_FIN_RAB date not null, 
    NB_MOIS_RAB number(2) not null, 
    MNT_RAB number(5,2) not null,
    POURCENTAGE_RAB number(2) not null,
    constraint PK_TP2_RA_CODE_RABAIS primary key(CODE_RABAIS),
    constraint AK_TP2_RA_NOM_RABAIS unique(NOM_RABAIS)
    );

create table TP2_RECU (
    NO_MEMBRE number(6) not null, 
    DATE_RECU date not null, 
    MNT_RECU number(5,2) not null, 
    CODE_RABAIS char(3) null, 
    MNT_RABAIS_RECU number(4,2) null,
    constraint PK_TP2_RCU_NO_MEM_DATE_RCU primary key(NO_MEMBRE, DATE_RECU)
    );

create table TP2_ALIMENT (
    NO_ALIMENT number(6) not null, 
    NOM_ALI varchar2(20) not null, 
    PORTION_ALI number(2) not null, 
    UNITE_ALI varchar2(18) default 'gramme' not null, 
    NB_LIPIDE_ALI number(5,2) not null, 
    NB_GLUCIDE_ALI number(5,2) not null,
    NB_FIBRE_ALI number(5,2) not null, 
    NB_PROTEINE_ALI number(5,2) not null, 
    NOM_RESTAURANT_ALI varchar2(20) null, 
    NO_MEMBRE number(6) null,
    BOOL_EST_PARTAGE_ALI number(1) null, 
    NUMERO_CODE_BARRE_ALI varchar2(12) null, 
    CATEGORIE_ALI  varchar2(20) null, 
    NB_POINTS_ALI number(3,2) null,
    constraint PK_TP2_AL_NO_ALIMENT primary key(NO_ALIMENT),
    constraint AK_TP2_AL_NOM_VALEURS_NUT unique(NOM_ALI, PORTION_ALI, UNITE_ALI, 
        NB_LIPIDE_ALI, NB_GLUCIDE_ALI,NB_FIBRE_ALI, NB_PROTEINE_ALI),
    constraint FK_TP2_AL_NO_MEMBRE foreign key (NO_MEMBRE) references
        TP2_MEMBRE(NO_MEMBRE)
    );
create sequence TP2_NO_ALIMENT_SEQ start with 1 increment by 1;

create table TP2_RECETTE (
    NO_RECETTE number(6) generated by default as identity not null, 
    TITRE_RECETTE varchar2(30) not null, 
    TEXTE_INSTRUCTION_REC varchar2(2000) not null, 
    NB_PERSONNE_PORTION_REC number(2) not null,
    constraint PK_TP2_RE_NO_RECETTE primary key(NO_RECETTE),
    constraint AK_TP2_RE_TITRE_RECETTE unique(TITRE_RECETTE)
    );
    
create table TP2_RECETTE_ALIMENT (
    NO_RECETTE number(6) not null, 
    NO_ALIMENT number(6) not null, 
    PORTION_ALIMENT_REC number(2) not null,
    PORTION_UNITE_ALIMENT_REC number(2) not null, 
    NB_POINTS_REC number(4,2) not null,
    constraint PK_TP2_RA_NO_REC_NO_ALI primary key(NO_RECETTE, NO_ALIMENT),
    constraint FK_TP2_RA_NO_RECETTE foreign key(NO_RECETTE) references
        TP2_RECETTE(NO_RECETTE),
    constraint FK_TP2_RA_NO_ALIMENT foreign key(NO_ALIMENT) references
        TP2_ALIMENT(NO_ALIMENT)
    );

create table TP2_ACTIVITE (
    NOM_ACTIVITE varchar2(20) not null, 
    SECTION_ACT varchar2(14) not null, 
    NB_POINTS_ACT number(4,2) not null, 
    NO_MEMBRE number(6) not null,
    constraint PK_TP2_AC_NOM_ACTIVITE primary key(NOM_ACTIVITE)
    );

create table TP2_SEMAINE (
    NO_SEMAINE number(4) generated always as identity not null, 
    NO_MEMBRE number(6) not null, 
    DATE_DEBUT_SEM date not null, 
    POIDS_DEBUT_SEM number(5,2) not null,
    POINTS_QUOTIDIEN_SEM number(4,2) not null,
    constraint PK_TP2_SE_NO_SEMAINE primary key(NO_SEMAINE),
    constraint AK_TP2_SE_NO_MEM_DATE_DEB unique(NO_MEMBRE, DATE_DEBUT_SEM)
    );

create table TP2_JOUR_ALIMENT (
    NO_SEMAINE number(4) not null,
    DATE_JOUR date not null,
    PHASE_JOUR varchar2(10) not null,
    NO_ALIMENT number(6) not null,
    PORTION_VALEUR_JOUR_ALI number(2) not null,
    PORTION_UNITE_JOUR_RALI number(2) not null,
    NB_POINTS_JOUR_ALI number(4,2) not null,
    constraint PK_TP2_JAL_NO_SEM_DATE_JOU primary key(NO_SEMAINE, DATE_JOUR, 
        PHASE_JOUR, NO_ALIMENT),
    constraint FK_TP2_JAL_NO_SEMAINE foreign key(NO_SEMAINE) references
        TP2_SEMAINE(NO_SEMAINE) on delete cascade,
    constraint FK_TP2_JAL_NO_ALIMENT foreign key(NO_ALIMENT) references
        TP2_ALIMENT(NO_ALIMENT)
    );

create table TP2_JOUR_ACTIVITE (
    NO_SEMAINE number(4) not null, 
    DATE_JOUR date not null, 
    PHASE_JOUR varchar2(10) not null, 
    NOM_ACTIVITE varchar2(20) not null, 
    NB_POINTS_JOUR_ACT number(4,2) not null,
    constraint PK_TP2_JAC_NO_SEM_DATE_JOU primary key(NO_SEMAINE, DATE_JOUR, 
        PHASE_JOUR, NOM_ACTIVITE),
    constraint FK_TP2_JAC_NO_SEMAINE foreign key(NO_SEMAINE) references
        TP2_SEMAINE(NO_SEMAINE) on delete cascade,
    constraint FK_TP2_JAC_NOM_ACTIVITE foreign key(NOM_ACTIVITE) references
        TP2_ACTIVITE(NOM_ACTIVITE)
    );

create table TP2_JOUR_RECETTE (
    NO_SEMAINE number(4) not null,
    DATE_JOUR date not null,
    PHASE_JOUR varchar2(10) not null,
    TITRE_RECETTE varchar2(30) not null,
    PORTION_JOUR_REC number(2) not null,
    NB_POINTS_JOUR_REC number(4,2) not null,
    constraint PK_JOUR_RECETTE primary key(NO_SEMAINE, DATE_JOUR, 
        PHASE_JOUR, TITRE_RECETTE),
    constraint FK_TP2_JRE_NO_SEMAINE foreign key(NO_SEMAINE) references
        TP2_SEMAINE(NO_SEMAINE) on delete cascade,
    constraint FK_TP2_JRE_TITRE_RECETTE foreign key(TITRE_RECETTE) references
        TP2_RECETTE(TITRE_RECETTE)
    );

create or replace view TP2_VUE_UTILISATEUR as 
    select NOM_USAGER_MEM as NOM_USAGER_UTILISATEUR, 
        MOT_DE_PASSE_MEM as MOT_DE_PASSE_UTI, 
        PRENOM_MEM || ' ' || NOM_MEM as NOM_COMPLET_UTI, 
        COURRIEL_MEM as COURRIEL_UTI, 'Membre' as TYPE_UTI from TP2_MEMBRE
    union select NOM_USAGER_ADMINISTRATEUR as NOM_USAGER_UTILISATEUR,
    MOT_DE_PASSE_ADM as MOT_DE_PASSE_UTI,
    PRENOM_ADM || ' ' || NOM_ADM as NOM_COMPLET_UTI,
    COURRIEL_ADM as COURRIEL_UTI,
    'Administrateur' as TYPE_UTI from TP2_ADMINISTRATEUR;

-- Question 1. b)
insert into TP2_ADMINISTRATEUR (NOM_USAGER_ADMINISTRATEUR, MOT_DE_PASSE_ADM,
    PRENOM_ADM, NOM_ADM,COURRIEL_ADM)
    values ('admin1', 'passWord123', 'Jonathan', 'Lacoste',
    'jonathan@example.org');

insert into TP2_ADMINISTRATEUR (NOM_USAGER_ADMINISTRATEUR, MOT_DE_PASSE_ADM,
    PRENOM_ADM, NOM_ADM,COURRIEL_ADM)
    values ('admin2', 'passWord456', 'Martin', 'Caron', 'martin@example.org');
 
insert into TP2_MEMBRE (NO_MEMBRE, NOM_USAGER_MEM, MOT_DE_PASSE_MEM, PRENOM_MEM,
    NOM_MEM, ADRESSE_MEM,VILLE_MEM, CODE_POSTAL_MEM, TELEPHONE_MEM,
    COURRIEL_MEM,BOOL_COURRIEL_EST_APPROUVE_MEM, SEXE_MEM, TAILLE_MEM,
    DATE_INSCRIPTION_MEM,DATE_NAISSANCE_MEM, NO_CARTE_CREDIT_MEM,
    EXPIRATION_CARTE_CREDIT_MEM,CCV_CARTE_CREDIT_MEM, POIDS_INITIAL_MEM,
    POIDS_DESIRE_MEM, UNITE_POIDS_MEM,BOOL_EST_EN_MAINTIENT,
    CHEMIN_PHOTO_AVANT_MEM, CHEMIN_PHOTO_APRES_MEM)
    values (TP2_NO_MEMBRE_SEQ.nextval, 'mfalouhja', 'Mot123', 'Marc',
    'Falouhja', '900 rue Université', 'Québec', 'G2G 5Y6', '418-616-2160',
    'mfalouhja@example.org', 1, 'M', 1.5, to_date('2015-06-01', 'YYYY-MM-DD'),
    to_date('1982-05-06', 'YYYY-MM-DD'), 4540258745202469, 2023,123, 180.1,
    70.1, 'lb', 1, '/membre123-a.png', '/membre123-b.png');

insert into TP2_MEMBRE (NO_MEMBRE, NOM_USAGER_MEM, MOT_DE_PASSE_MEM, PRENOM_MEM,
    NOM_MEM, ADRESSE_MEM,VILLE_MEM, CODE_POSTAL_MEM, TELEPHONE_MEM,
    COURRIEL_MEM, BOOL_COURRIEL_EST_APPROUVE_MEM, SEXE_MEM, TAILLE_MEM,
    DATE_INSCRIPTION_MEM,DATE_NAISSANCE_MEM, NO_CARTE_CREDIT_MEM,
    EXPIRATION_CARTE_CREDIT_MEM,CCV_CARTE_CREDIT_MEM, POIDS_INITIAL_MEM,
    POIDS_DESIRE_MEM, UNITE_POIDS_MEM,BOOL_EST_EN_MAINTIENT,
    CHEMIN_PHOTO_AVANT_MEM, CHEMIN_PHOTO_APRES_MEM, NO_MEMBRE_RECOMMANDE)
    values (TP2_NO_MEMBRE_SEQ.nextval, 'ttremblay', 'Mot123', 'Tohata',
    'Tremblay', '400 rue Université', 'Québec', 'G2G 5Y6', '418-714-8560',
    'tremblay@hotmail.com', 1, 'F', 1.2, to_date('2015-06-07', 'YYYY-MM-DD'),
    to_date('1985-02-10', 'YYYY-MM-DD'), 4688258745202469, 2023,123, 180.1,
    75.1, 'lb', 1, '/membre123-a.png', '/membre123-b.png', 10);

insert into TP2_MEMBRE (NO_MEMBRE, NOM_USAGER_MEM, MOT_DE_PASSE_MEM, PRENOM_MEM,
    NOM_MEM, ADRESSE_MEM,VILLE_MEM, CODE_POSTAL_MEM, TELEPHONE_MEM,
    COURRIEL_MEM,BOOL_COURRIEL_EST_APPROUVE_MEM, SEXE_MEM, TAILLE_MEM,
    DATE_INSCRIPTION_MEM,DATE_NAISSANCE_MEM, NO_CARTE_CREDIT_MEM,
    EXPIRATION_CARTE_CREDIT_MEM,CCV_CARTE_CREDIT_MEM, POIDS_INITIAL_MEM,
    POIDS_DESIRE_MEM, UNITE_POIDS_MEM,BOOL_EST_EN_MAINTIENT,
    CHEMIN_PHOTO_AVANT_MEM, CHEMIN_PHOTO_APRES_MEM, NO_MEMBRE_RECOMMANDE)
    values (TP2_NO_MEMBRE_SEQ.nextval, 'rsansom', 'Mot123', 'Rachid', 'Sansom',
    '401 rue Université', 'Quebec', 'G2G 5Y6', '418-717-4760',
    'sansom@hotmail.com', 1, 'F', 1.2, to_date('2015-06-07', 'YYYY-MM-DD'),
    to_date('2001-02-11', 'YYYY-MM-DD'), 4684358745202469, 2023,123, 180.1,
    170.1, 'lb', 1, '/membre1234-a.png', '/membre1234-b.png', 10);

insert into TP2_MEMBRE (NO_MEMBRE, NOM_USAGER_MEM, MOT_DE_PASSE_MEM, PRENOM_MEM,
    NOM_MEM, ADRESSE_MEM,VILLE_MEM, CODE_POSTAL_MEM, TELEPHONE_MEM,
    COURRIEL_MEM,BOOL_COURRIEL_EST_APPROUVE_MEM, SEXE_MEM, TAILLE_MEM,
    DATE_INSCRIPTION_MEM,DATE_NAISSANCE_MEM, NO_CARTE_CREDIT_MEM,
    EXPIRATION_CARTE_CREDIT_MEM,CCV_CARTE_CREDIT_MEM, POIDS_INITIAL_MEM,
    POIDS_DESIRE_MEM, UNITE_POIDS_MEM,BOOL_EST_EN_MAINTIENT,
    CHEMIN_PHOTO_AVANT_MEM, CHEMIN_PHOTO_APRES_MEM)
    values (TP2_NO_MEMBRE_SEQ.nextval, 'stremblay', 'Mot1233', 'Sylvie',
    'Tremblay', '400 rue Université', 'QUEBEC', 'G2G 5Y6', '418-713-2160',
    'stremblay@hotmail.com', 1, 'F', 1.2, to_date('2014-06-07', 'YYYY-MM-DD'),
    to_date('1990-06-18', 'YYYY-MM-DD'), 4687258745202469, 2023,123, 180.1,
    65.2, 'lb', 1, '/membre123-a.png', '/membre123-b.png');

alter table TP2_RABAIS
    add NOM_FICHIER_IMAGE_RAB varchar2(100) null;

insert into TP2_RABAIS (CODE_RABAIS, NOM_RABAIS, DATE_DEBUT_RAB, DATE_FIN_RAB,
    NB_MOIS_RAB, MNT_RAB,POURCENTAGE_RAB, NOM_FICHIER_IMAGE_RAB)
    values ('PAR', 'Groupe parapente', to_date('2021-06-10', 'YYYY-MM-DD'),
    to_date('2021-10-10', 'YYYY-MM-DD'), 18, 10.50, 15,'PAR.png');
insert into TP2_RABAIS (CODE_RABAIS, NOM_RABAIS, DATE_DEBUT_RAB, DATE_FIN_RAB,
    NB_MOIS_RAB, MNT_RAB,POURCENTAGE_RAB)
    values ('ALI', 'Groupe aliments', to_date('2017-02-10', 'YYYY-MM-DD'),
    to_date('2017-02-10', 'YYYY-MM-DD'), 18, 10.50, 15);
insert into TP2_RABAIS (CODE_RABAIS, NOM_RABAIS, DATE_DEBUT_RAB, DATE_FIN_RAB,
    NB_MOIS_RAB, MNT_RAB,POURCENTAGE_RAB, NOM_FICHIER_IMAGE_RAB)
    values ('9SP', '9 mois c’est super', to_date('2021-01-10', 'YYYY-MM-DD'),
    to_date('2021-10-10', 'YYYY-MM-DD'), 18, 10.50, 15, '9SP.png');


insert into TP2_RECU (NO_MEMBRE, DATE_RECU, MNT_RECU)
    values (10, to_date('2021-01-31', 'YYYY-MM-DD'), 50);
insert into TP2_RECU (NO_MEMBRE, DATE_RECU, MNT_RECU, CODE_RABAIS,
    MNT_RABAIS_RECU)
    values (10, to_date('2017-02-10', 'YYYY-MM-DD'), 50, 'PAR', 25);
insert into TP2_RECU (NO_MEMBRE, DATE_RECU, MNT_RECU)
    values (15, to_date('2021-02-10', 'YYYY-MM-DD'), 50);

insert into TP2_ALIMENT (NO_ALIMENT, NOM_ALI, PORTION_ALI,  NB_LIPIDE_ALI,
    NB_GLUCIDE_ALI,NB_FIBRE_ALI, NB_PROTEINE_ALI, NO_MEMBRE,
    BOOL_EST_PARTAGE_ALI, NUMERO_CODE_BARRE_ALI, CATEGORIE_ALI, NB_POINTS_ALI)
    values (TP2_NO_ALIMENT_SEQ.nextval, 'Pomme', 1, 2.1, 1.4, 5.7, 0.3, 20, 1,
    'PM7653', 'Fruits', 1);
insert into TP2_ALIMENT (NO_ALIMENT, NOM_ALI, PORTION_ALI,  NB_LIPIDE_ALI,
    NB_GLUCIDE_ALI,NB_FIBRE_ALI, NB_PROTEINE_ALI, NO_MEMBRE,
    BOOL_EST_PARTAGE_ALI, NUMERO_CODE_BARRE_ALI, CATEGORIE_ALI, NB_POINTS_ALI)
    values (TP2_NO_ALIMENT_SEQ.nextval, 'Banane', 1, 4.1, 5.4, 8.7, 0.3, 10, 1,
    'PM7654', 'Fruits', 1);
insert into TP2_ALIMENT (NO_ALIMENT, NOM_ALI, PORTION_ALI,  NB_LIPIDE_ALI,
    NB_GLUCIDE_ALI,NB_FIBRE_ALI, NB_PROTEINE_ALI, NO_MEMBRE,
    BOOL_EST_PARTAGE_ALI, NUMERO_CODE_BARRE_ALI, CATEGORIE_ALI, NB_POINTS_ALI)
    values (TP2_NO_ALIMENT_SEQ.nextval, 'BananeP', 1, 4.1, 5.4, 8.7, 0.3, 15, 0,
    'PM7657', 'Surgelé', 6);

insert into TP2_RECETTE (TITRE_RECETTE, TEXTE_INSTRUCTION_REC, 
    NB_PERSONNE_PORTION_REC)
    values ('Banane royale', 'Mettre une banane avec crème glacée', 2);
insert into TP2_RECETTE (TITRE_RECETTE, TEXTE_INSTRUCTION_REC, 
    NB_PERSONNE_PORTION_REC)
    values ('Pomme caramel', 'Mettre une pomme avec caramel', 1);
insert into TP2_RECETTE (TITRE_RECETTE, TEXTE_INSTRUCTION_REC, 
    NB_PERSONNE_PORTION_REC)
    values ('BananeP', 'Faire décongeler la banane', 1);
insert into TP2_RECETTE (NO_RECETTE, TITRE_RECETTE, TEXTE_INSTRUCTION_REC,
    NB_PERSONNE_PORTION_REC)
    values (22 , 'PatatePlus', 'Faire chauffer les patates', 3);
insert into TP2_RECETTE (NO_RECETTE, TITRE_RECETTE, TEXTE_INSTRUCTION_REC,
    NB_PERSONNE_PORTION_REC)
    values (99 , 'PatatePremium', 'Faire chauffer les patates', 3);

insert into TP2_RECETTE_ALIMENT (NO_RECETTE, NO_ALIMENT, PORTION_ALIMENT_REC,
    PORTION_UNITE_ALIMENT_REC, NB_POINTS_REC)
    values (1, 1, 1, 1, 2);
insert into TP2_RECETTE_ALIMENT (NO_RECETTE, NO_ALIMENT, PORTION_ALIMENT_REC,
    PORTION_UNITE_ALIMENT_REC, NB_POINTS_REC)
    values (2, 2, 1, 1, 2);
insert into TP2_RECETTE_ALIMENT (NO_RECETTE, NO_ALIMENT, PORTION_ALIMENT_REC,
    PORTION_UNITE_ALIMENT_REC, NB_POINTS_REC)
    values (22, 2, 1, 1, 3);

insert into TP2_ACTIVITE (NOM_ACTIVITE, SECTION_ACT, NB_POINTS_ACT, NO_MEMBRE)
    values ('Course rapide', 'Course', 5, 10);
insert into TP2_ACTIVITE (NOM_ACTIVITE, SECTION_ACT, NB_POINTS_ACT, NO_MEMBRE)
    values ('Nage rapide', 'Aquatique', 3, 10);

insert into TP2_SEMAINE (NO_MEMBRE, DATE_DEBUT_SEM, POIDS_DEBUT_SEM,
    POINTS_QUOTIDIEN_SEM)
    values (10, to_date('2021-02-10', 'YYYY-MM-DD'), 175, 80);
insert into TP2_SEMAINE (NO_MEMBRE, DATE_DEBUT_SEM, POIDS_DEBUT_SEM,
    POINTS_QUOTIDIEN_SEM)
    values (10, to_date('2020-02-17', 'YYYY-MM-DD'), 174, 80);
insert into TP2_SEMAINE (NO_MEMBRE, DATE_DEBUT_SEM, POIDS_DEBUT_SEM,
    POINTS_QUOTIDIEN_SEM)
    values (15, to_date('2020-03-17', 'YYYY-MM-DD'), 160, 80);

insert into TP2_JOUR_ALIMENT (NO_SEMAINE, DATE_JOUR, PHASE_JOUR, NO_ALIMENT,
    PORTION_VALEUR_JOUR_ALI, PORTION_UNITE_JOUR_RALI, NB_POINTS_JOUR_ALI)
    values (1, to_date('2020-02-17', 'YYYY-MM-DD'), 1, 1, 3, 2, 5);
insert into TP2_JOUR_ALIMENT (NO_SEMAINE, DATE_JOUR, PHASE_JOUR, NO_ALIMENT,
    PORTION_VALEUR_JOUR_ALI, PORTION_UNITE_JOUR_RALI, NB_POINTS_JOUR_ALI)
    values (1, to_date('2020-02-17', 'YYYY-MM-DD'), 2, 1, 3, 2, 5);

insert into TP2_JOUR_ACTIVITE (NO_SEMAINE, DATE_JOUR, PHASE_JOUR, NOM_ACTIVITE,
    NB_POINTS_JOUR_ACT)
    values (1, to_date('2020-02-17', 'YYYY-MM-DD'), 2, 'Course rapide', 5);
insert into TP2_JOUR_ACTIVITE (NO_SEMAINE, DATE_JOUR, PHASE_JOUR, NOM_ACTIVITE,
    NB_POINTS_JOUR_ACT)
    values (1, to_date('2020-02-18', 'YYYY-MM-DD'), 2, 'Course rapide', 5);

insert into  TP2_JOUR_RECETTE (NO_SEMAINE, DATE_JOUR, PHASE_JOUR, TITRE_RECETTE,
    PORTION_JOUR_REC, NB_POINTS_JOUR_REC)
    values (1, to_date('2020-02-18', 'YYYY-MM-DD'), 2, 'Banane royale', 1, 5);
insert into  TP2_JOUR_RECETTE (NO_SEMAINE, DATE_JOUR, PHASE_JOUR, TITRE_RECETTE,
    PORTION_JOUR_REC, NB_POINTS_JOUR_REC)
    values (1, to_date('2020-02-18', 'YYYY-MM-DD'), 2, 'Pomme caramel', 1, 5);

-- Question 1. c)
insert into TP2_RECETTE_ALIMENT (NO_RECETTE, NO_ALIMENT, PORTION_ALIMENT_REC,
    PORTION_UNITE_ALIMENT_REC, NB_POINTS_REC)
    select 99, NO_ALIMENT, PORTION_ALIMENT_REC, PORTION_UNITE_ALIMENT_REC,
    NB_POINTS_REC from TP2_RECETTE_ALIMENT where NO_RECETTE = 22;

alter table TP2_MEMBRE
    add SURNOM_MEM varchar2(20) null;
    
/*Début TP3*/

alter table TP2_SEMAINE
    add BOOL_EST_ARCHIVEE number(1) default 0 not null;
    
alter table TP2_JOUR_ALIMENT
    add BOOL_EST_ARCHIVEE number(1) default 0 not null;
    
alter table TP2_JOUR_ACTIVITE
    add BOOL_EST_ARCHIVEE number(1) default 0 not null;


--Rabais
insert into TP2_RABAIS (CODE_RABAIS, NOM_RABAIS, DATE_DEBUT_RAB, DATE_FIN_RAB,
    NB_MOIS_RAB, MNT_RAB,POURCENTAGE_RAB)
    values ('ANV', 'Anniversaire', to_date('2019-01-20', 'YYYY-MM-DD'),
    to_date('2020-01-20', 'YYYY-MM-DD'), 12, 10, 10);


insert into TP2_RABAIS (CODE_RABAIS, NOM_RABAIS, DATE_DEBUT_RAB, DATE_FIN_RAB,
    NB_MOIS_RAB, MNT_RAB,POURCENTAGE_RAB)
    values ('AOR', 'Age d''or', to_date('2015-10-10', 'YYYY-MM-DD'),
    to_date('2020-10-10', 'YYYY-MM-DD'), 60, 300, 20);


insert into TP2_RABAIS (CODE_RABAIS, NOM_RABAIS, DATE_DEBUT_RAB, DATE_FIN_RAB,
    NB_MOIS_RAB, MNT_RAB,POURCENTAGE_RAB)
    values ('DUO', 'Abonnement avec amis', to_date('2018-03-01', 'YYYY-MM-DD'),
    to_date('2018-09-01', 'YYYY-MM-DD'), 6, 20, 10);

--Aliments
insert into TP2_ALIMENT (NO_ALIMENT, NOM_ALI, PORTION_ALI,  NB_LIPIDE_ALI,
    NB_GLUCIDE_ALI,NB_FIBRE_ALI, NB_PROTEINE_ALI, NO_MEMBRE,
    BOOL_EST_PARTAGE_ALI, NUMERO_CODE_BARRE_ALI, CATEGORIE_ALI, NB_POINTS_ALI,
    NOM_RESTAURANT_ALI)
    values (TP2_NO_ALIMENT_SEQ.nextval, 'Saumon', 1, 3.1, 0.5, 0.0, 10.2, 25, 0,
    'PO2842', 'Poissons', 5, 'Le filet');

insert into TP2_ALIMENT (NO_ALIMENT, NOM_ALI, PORTION_ALI,  NB_LIPIDE_ALI,
    NB_GLUCIDE_ALI,NB_FIBRE_ALI, NB_PROTEINE_ALI, NO_MEMBRE,
    BOOL_EST_PARTAGE_ALI, NUMERO_CODE_BARRE_ALI, CATEGORIE_ALI, NB_POINTS_ALI)
    values (TP2_NO_ALIMENT_SEQ.nextval, 'Concombre', 1, 0.6, 0.1, 0.5, 0.2, 
    25, 0,'PM1102', 'Fruits', 0);
    
insert into TP2_ALIMENT (NO_ALIMENT, NOM_ALI, PORTION_ALI,  NB_LIPIDE_ALI,
    NB_GLUCIDE_ALI,NB_FIBRE_ALI, NB_PROTEINE_ALI, NO_MEMBRE,
    BOOL_EST_PARTAGE_ALI, NUMERO_CODE_BARRE_ALI, CATEGORIE_ALI, NB_POINTS_ALI,
    NOM_RESTAURANT_ALI)
    values (TP2_NO_ALIMENT_SEQ.nextval, 'Avocat', 1, 6.8, 0.9, 0.2, 3.4, 25, 0,
    'PM8301', 'Fruits', 3, 'Los pollos hermanos');

insert into TP2_ALIMENT (NO_ALIMENT, NOM_ALI, PORTION_ALI,  NB_LIPIDE_ALI,
    NB_GLUCIDE_ALI,NB_FIBRE_ALI, NB_PROTEINE_ALI, NO_MEMBRE,
    BOOL_EST_PARTAGE_ALI, NUMERO_CODE_BARRE_ALI, CATEGORIE_ALI, NB_POINTS_ALI)
    values (TP2_NO_ALIMENT_SEQ.nextval, 'Gingembre', 1, 0.2, 1.1, 1.0, 0.2, 25,
    0, 'PR3493', 'Racines', 0);

insert into TP2_ALIMENT (NO_ALIMENT, NOM_ALI, PORTION_ALI,  NB_LIPIDE_ALI,
    NB_GLUCIDE_ALI,NB_FIBRE_ALI, NB_PROTEINE_ALI, NO_MEMBRE,
    BOOL_EST_PARTAGE_ALI, NUMERO_CODE_BARRE_ALI, CATEGORIE_ALI, NB_POINTS_ALI)
    values (TP2_NO_ALIMENT_SEQ.nextval, 'Coriandre', 1, 0.1, 0.1, 0.1, 0.1, 25, 
    0, 'PH1293', 'Herbes', 0);

insert into TP2_ALIMENT (NO_ALIMENT, NOM_ALI, PORTION_ALI,  NB_LIPIDE_ALI,
    NB_GLUCIDE_ALI,NB_FIBRE_ALI, NB_PROTEINE_ALI, NO_MEMBRE,
    BOOL_EST_PARTAGE_ALI, NUMERO_CODE_BARRE_ALI, CATEGORIE_ALI, NB_POINTS_ALI)
    values (TP2_NO_ALIMENT_SEQ.nextval, 'Onion', 1, 0.3, 0.4, 0.1, 0.2, 25, 0,
    'PL4353', 'Legumes', 0);

insert into TP2_ALIMENT (NO_ALIMENT, NOM_ALI, PORTION_ALI,  NB_LIPIDE_ALI,
    NB_GLUCIDE_ALI,NB_FIBRE_ALI, NB_PROTEINE_ALI, NO_MEMBRE,
    BOOL_EST_PARTAGE_ALI, NUMERO_CODE_BARRE_ALI, CATEGORIE_ALI, NB_POINTS_ALI,
    NOM_RESTAURANT_ALI)
    values (TP2_NO_ALIMENT_SEQ.nextval, 'Pain', 1, 8.1, 4.4, 2.7, 0.7, 25, 0,
    'PB1337', 'Boulangerie', 6, 'Banh Mi Mon Ami');

insert into TP2_ALIMENT (NO_ALIMENT, NOM_ALI, PORTION_ALI,  NB_LIPIDE_ALI,
    NB_GLUCIDE_ALI,NB_FIBRE_ALI, NB_PROTEINE_ALI, NO_MEMBRE,
    BOOL_EST_PARTAGE_ALI, NUMERO_CODE_BARRE_ALI, CATEGORIE_ALI, NB_POINTS_ALI,
    NOM_RESTAURANT_ALI)
    values (TP2_NO_ALIMENT_SEQ.nextval, 'Poulet', 1, 5.1, 1.4, 1.7, 11.7, 25, 1,
    'PV1317', 'Volaille', 6, 'PFK');

insert into TP2_ALIMENT (NO_ALIMENT, NOM_ALI, PORTION_ALI,  NB_LIPIDE_ALI,
    NB_GLUCIDE_ALI,NB_FIBRE_ALI, NB_PROTEINE_ALI, NO_MEMBRE,
    BOOL_EST_PARTAGE_ALI, NUMERO_CODE_BARRE_ALI, CATEGORIE_ALI, NB_POINTS_ALI,
    NOM_RESTAURANT_ALI)
    values (TP2_NO_ALIMENT_SEQ.nextval, 'Citron', 1, 0.2, 0.1, 0.3, 0.3, 25, 1,
    'PM3417', 'Fruits', 0, 'Limonade Rosemont');
    
insert into TP2_ALIMENT (NO_ALIMENT, NOM_ALI, PORTION_ALI,  NB_LIPIDE_ALI,
    NB_GLUCIDE_ALI,NB_FIBRE_ALI, NB_PROTEINE_ALI, NO_MEMBRE,
    BOOL_EST_PARTAGE_ALI, NUMERO_CODE_BARRE_ALI, CATEGORIE_ALI, NB_POINTS_ALI,
    NOM_RESTAURANT_ALI)
    values (TP2_NO_ALIMENT_SEQ.nextval, 'Croquette', 1, 12.1, 1.1, 1.7, 8.3, 15, 
    0,'PS7372', 'Surgelé', 9, 'Wendy''s');

--Recette
insert into TP2_RECETTE (NO_RECETTE, TITRE_RECETTE, TEXTE_INSTRUCTION_REC, 
    NB_PERSONNE_PORTION_REC)
    values (4, 'Tartare de poulet', 'Laver poulet avec citron, 
    servir tiède sur lit de corriandre', 7);

insert into TP2_RECETTE (NO_RECETTE, TITRE_RECETTE, TEXTE_INSTRUCTION_REC, 
    NB_PERSONNE_PORTION_REC)
    values (5, 'Pain banne et oignon', 'Mélanger pain, oignon et 2 bannanes, 
    mettre au micro-ondes 30 minutes, servir sur glace', 2);
    
insert into TP2_RECETTE (NO_RECETTE, TITRE_RECETTE, TEXTE_INSTRUCTION_REC, 
    NB_PERSONNE_PORTION_REC)
    values (6, 'Saumon oriental', 'Couper tranches de pommes, mélanger avec purée 
    d''avocat et soupoudré de saumon haché', 3);

--RECETTE_ALIMENT
    
insert into TP2_RECETTE_ALIMENT (NO_RECETTE, NO_ALIMENT, PORTION_ALIMENT_REC,
    PORTION_UNITE_ALIMENT_REC, NB_POINTS_REC)
    values (4, 11, 2, 1, 8);

insert into TP2_RECETTE_ALIMENT (NO_RECETTE, NO_ALIMENT, PORTION_ALIMENT_REC,
    PORTION_UNITE_ALIMENT_REC, NB_POINTS_REC)
    values (4, 12, 4, 1, 8);

insert into TP2_RECETTE_ALIMENT (NO_RECETTE, NO_ALIMENT, PORTION_ALIMENT_REC,
    PORTION_UNITE_ALIMENT_REC, NB_POINTS_REC)
    values (4, 8, 2, 1, 8);
    

insert into TP2_RECETTE_ALIMENT (NO_RECETTE, NO_ALIMENT, PORTION_ALIMENT_REC,
    PORTION_UNITE_ALIMENT_REC, NB_POINTS_REC)
    values (5, 10, 1, 1, 5);

insert into TP2_RECETTE_ALIMENT (NO_RECETTE, NO_ALIMENT, PORTION_ALIMENT_REC,
    PORTION_UNITE_ALIMENT_REC, NB_POINTS_REC)
    values (5, 2, 2, 1, 5);

insert into TP2_RECETTE_ALIMENT (NO_RECETTE, NO_ALIMENT, PORTION_ALIMENT_REC,
    PORTION_UNITE_ALIMENT_REC, NB_POINTS_REC)
    values (5, 9, 1, 1, 5);
    

insert into TP2_RECETTE_ALIMENT (NO_RECETTE, NO_ALIMENT, PORTION_ALIMENT_REC,
    PORTION_UNITE_ALIMENT_REC, NB_POINTS_REC)
    values (6, 4, 1, 1, 6);

insert into TP2_RECETTE_ALIMENT (NO_RECETTE, NO_ALIMENT, PORTION_ALIMENT_REC,
    PORTION_UNITE_ALIMENT_REC, NB_POINTS_REC)
    values (6, 1, 2, 1, 6);

insert into TP2_RECETTE_ALIMENT (NO_RECETTE, NO_ALIMENT, PORTION_ALIMENT_REC,
    PORTION_UNITE_ALIMENT_REC, NB_POINTS_REC)
    values (6, 6, 2, 1, 6);

--SEMAINE
insert into TP2_SEMAINE (NO_MEMBRE, DATE_DEBUT_SEM, POIDS_DEBUT_SEM,
    POINTS_QUOTIDIEN_SEM)
    values (25, to_date('2020-02-10', 'YYYY-MM-DD'), 177, 80);
    
insert into TP2_SEMAINE (NO_MEMBRE, DATE_DEBUT_SEM, POIDS_DEBUT_SEM,
    POINTS_QUOTIDIEN_SEM)
    values (25, to_date('2021-05-27', 'YYYY-MM-DD'), 173, 80);
    
insert into TP2_SEMAINE (NO_MEMBRE, DATE_DEBUT_SEM, POIDS_DEBUT_SEM,
    POINTS_QUOTIDIEN_SEM)
    values (25, to_date('2021-06-22', 'YYYY-MM-DD'), 179, 80);

insert into TP2_SEMAINE (NO_MEMBRE, DATE_DEBUT_SEM, POIDS_DEBUT_SEM,
    POINTS_QUOTIDIEN_SEM)
    values (22, to_date('2018-02-22', 'YYYY-MM-DD'), 324, 80);

--JOUR_ALIMENT
insert into TP2_JOUR_ALIMENT (NO_SEMAINE, DATE_JOUR, PHASE_JOUR, NO_ALIMENT,
    PORTION_VALEUR_JOUR_ALI, PORTION_UNITE_JOUR_RALI, NB_POINTS_JOUR_ALI)
    values (2, to_date('2020-03-12', 'YYYY-MM-DD'), 1, 11, 3, 1, 6);
    
insert into TP2_JOUR_ALIMENT (NO_SEMAINE, DATE_JOUR, PHASE_JOUR, NO_ALIMENT,
    PORTION_VALEUR_JOUR_ALI, PORTION_UNITE_JOUR_RALI, NB_POINTS_JOUR_ALI)
    values (3, to_date('2020-04-14', 'YYYY-MM-DD'), 2, 2, 3, 1, 1);

insert into TP2_JOUR_ALIMENT (NO_SEMAINE, DATE_JOUR, PHASE_JOUR, NO_ALIMENT,
    PORTION_VALEUR_JOUR_ALI, PORTION_UNITE_JOUR_RALI, NB_POINTS_JOUR_ALI)
    values (4, to_date('2020-05-18', 'YYYY-MM-DD'), 3, 3, 3, 1, 6);

insert into TP2_JOUR_ALIMENT (NO_SEMAINE, DATE_JOUR, PHASE_JOUR, NO_ALIMENT,
    PORTION_VALEUR_JOUR_ALI, PORTION_UNITE_JOUR_RALI, NB_POINTS_JOUR_ALI)
    values (5, to_date('2020-06-30', 'YYYY-MM-DD'), 3, 4, 3, 1, 5);

insert into TP2_JOUR_ALIMENT (NO_SEMAINE, DATE_JOUR, PHASE_JOUR, NO_ALIMENT,
    PORTION_VALEUR_JOUR_ALI, PORTION_UNITE_JOUR_RALI, NB_POINTS_JOUR_ALI)
    values (6, to_date('2020-07-16', 'YYYY-MM-DD'), 2, 5, 3, 1, 0);

insert into TP2_JOUR_ALIMENT (NO_SEMAINE, DATE_JOUR, PHASE_JOUR, NO_ALIMENT,
    PORTION_VALEUR_JOUR_ALI, PORTION_UNITE_JOUR_RALI, NB_POINTS_JOUR_ALI)
    values (7, to_date('2020-08-17', 'YYYY-MM-DD'), 1, 6, 3, 1, 3);

--JOUR_ACTIVITE

insert into TP2_JOUR_ACTIVITE (NO_SEMAINE, DATE_JOUR, PHASE_JOUR, NOM_ACTIVITE,
    NB_POINTS_JOUR_ACT)
    values (2, to_date('2020-02-17', 'YYYY-MM-DD'), 2, 'Course rapide', 5);

insert into TP2_JOUR_ACTIVITE (NO_SEMAINE, DATE_JOUR, PHASE_JOUR, NOM_ACTIVITE,
    NB_POINTS_JOUR_ACT)
    values (3, to_date('2020-03-17', 'YYYY-MM-DD'), 2, 'Nage rapide', 3);

insert into TP2_JOUR_ACTIVITE (NO_SEMAINE, DATE_JOUR, PHASE_JOUR, NOM_ACTIVITE,
    NB_POINTS_JOUR_ACT)
    values (4, to_date('2020-04-17', 'YYYY-MM-DD'), 2, 'Nage rapide', 3);

insert into TP2_JOUR_ACTIVITE (NO_SEMAINE, DATE_JOUR, PHASE_JOUR, NOM_ACTIVITE,
    NB_POINTS_JOUR_ACT)
    values (5, to_date('2020-05-17', 'YYYY-MM-DD'), 1, 'Nage rapide', 3);

insert into TP2_JOUR_ACTIVITE (NO_SEMAINE, DATE_JOUR, PHASE_JOUR, NOM_ACTIVITE,
    NB_POINTS_JOUR_ACT)
    values (6, to_date('2020-06-17', 'YYYY-MM-DD'), 2, 'Course rapide', 5);

insert into TP2_JOUR_ACTIVITE (NO_SEMAINE, DATE_JOUR, PHASE_JOUR, NOM_ACTIVITE,
    NB_POINTS_JOUR_ACT)
    values (7, to_date('2020-07-17', 'YYYY-MM-DD'), 3, 'Course rapide', 5);

--JOUR_RECETTE
insert into  TP2_JOUR_RECETTE (NO_SEMAINE, DATE_JOUR, PHASE_JOUR, TITRE_RECETTE,
    PORTION_JOUR_REC, NB_POINTS_JOUR_REC)
    values (2, to_date('2020-02-18', 'YYYY-MM-DD'), 1, 'Tartare de poulet', 1, 8);

insert into  TP2_JOUR_RECETTE (NO_SEMAINE, DATE_JOUR, PHASE_JOUR, TITRE_RECETTE,
    PORTION_JOUR_REC, NB_POINTS_JOUR_REC)
    values (3, to_date('2020-03-18', 'YYYY-MM-DD'), 2, 'Saumon oriental', 1, 5);

insert into  TP2_JOUR_RECETTE (NO_SEMAINE, DATE_JOUR, PHASE_JOUR, TITRE_RECETTE,
    PORTION_JOUR_REC, NB_POINTS_JOUR_REC)
    values (4, to_date('2020-04-18', 'YYYY-MM-DD'), 2, 'Tartare de poulet', 1, 8);

insert into  TP2_JOUR_RECETTE (NO_SEMAINE, DATE_JOUR, PHASE_JOUR, TITRE_RECETTE,
    PORTION_JOUR_REC, NB_POINTS_JOUR_REC)
    values (5, to_date('2020-05-18', 'YYYY-MM-DD'), 3, 'Saumon oriental', 1, 5);

insert into  TP2_JOUR_RECETTE (NO_SEMAINE, DATE_JOUR, PHASE_JOUR, TITRE_RECETTE,
    PORTION_JOUR_REC, NB_POINTS_JOUR_REC)
    values (6, to_date('2020-06-18', 'YYYY-MM-DD'), 2, 'Saumon oriental', 1, 5);

insert into  TP2_JOUR_RECETTE (NO_SEMAINE, DATE_JOUR, PHASE_JOUR, TITRE_RECETTE,
    PORTION_JOUR_REC, NB_POINTS_JOUR_REC)
    values (7, to_date('2020-07-18', 'YYYY-MM-DD'), 3, 'Pain banne et oignon', 1, 3);

create or replace trigger TRG_BD_TP2_MEMBRE
    before delete on TP2_MEMBRE for each row

begin
    update TP2_ALIMENT
        set NO_MEMBRE = null
        where NO_MEMBRE = :old.NO_MEMBRE;
    
    
end TRG_BD_TP2_ALIMENT;
/